## Issue #22

- **Enhanced example**: New `examples/agent-toolhub-deepagents-sp500.mjs` using **LangChain 1.x** and **DeepAgents** (instead of ReAct agent).
- **Task**: Pick top 20 S&P 500 stocks by market cap, full analysis and prediction, generate consolidated HTML report of at least 5000 words (full analysis and predictions per stock and market-level).
- **ToolHub → LangChain**: `toolHubToLangChainTools(toolHub)` bridges ToolHub registry to LangChain tools for DeepAgents.
- **Prompt**: System prompt uses exact registry tool names (yahoo-finance-skill, tools/web-search-mcp, system-time-skill, tools/filesystem) and instructs the model not to invent tool names (fixes "functions? is not a valid tool" error).

## Changes

- `examples/agent-toolhub-deepagents-sp500.mjs` — new enhanced example
- `__tests__/examples/deepagents-sp500-example.test.ts` — tests that example config discovers required tools
- `package.json`: devDependencies (deepagents, langchain, @langchain/openai, zod), npm script `example:agent-toolhub-deepagents-sp500`
- `README.md`: Enhanced example section + `npm install --legacy-peer-deps` note

## How to run

```bash
npm install --legacy-peer-deps   # if peer dependency conflicts
npm run build
npm run example:agent-toolhub-deepagents-sp500
```

Quick run (3 stocks, short): `npm run example:agent-toolhub-deepagents-sp500:demo`. Long report in demo (3 stocks, 1500+ words): `npm run example:agent-toolhub-deepagents-sp500:demo:long`. Full run (20 stocks, 5000+ words) may need higher `RECURSION_LIMIT`. Report path: `examples/output/sp500-top20-report.html`.

Optional env: `OPENAI_BASE_URL`, `OPENAI_MODEL`, `OPENAI_API_KEY`, `RECURSION_LIMIT`, `DEMO` (or `SP500_DEMO=1`).

## Example fixes (report generation)

- **Report path**: `examples/output/sp500-top20-report.html`; output dir created at start; post-run check prints path or "not found".
- **Tool arguments**: Prompt instructs model to pass JSON only (fixes "parsing tool call" error).
- **Report tool**: Prompt instructs use of **tools/filesystem** for the report (not built-in write_file).
- **Recursion limit**: Default 150 (configurable via `RECURSION_LIMIT`).
- **Demo mode**: `DEMO=1` or `SP500_DEMO=1` for 3-stock run that reliably writes the file.
- **`.gitignore`**: `examples/output/`.

## Lint fix (bonus)

- **Line count**: Refactored `ToolHub.ts` to stay under 500 lines by moving `getToolDescription` logic to `ToolHubDescription.ts` (`extractSkillDefinitionFromSpec` + `specToToolDescription`). `./scripts/check-line-count.sh` now passes.

## Tests

- All 364 tests pass (`npm test`).
- New example tests: `__tests__/examples/deepagents-sp500-example.test.ts` (2 tests).
- `./scripts/check-line-count.sh` and `scripts/check-function-length.py` pass.
